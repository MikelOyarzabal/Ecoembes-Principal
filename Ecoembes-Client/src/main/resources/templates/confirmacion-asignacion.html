<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asignaci√≥n Completada - Ecoembes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .success-icon {
            font-size: 5rem;
            color: #28a745;
        }
        .stat-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
        }
        .badge-VERDE { background-color: #28a745; }
        .badge-AMARILLO { background-color: #ffc107; color: #212529; }
        .badge-ROJO { background-color: #dc3545; }
        .badge-LLENO { background-color: #6c757d; }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-dark">
        <div class="container-fluid">
            <a href="/dashboard" class="navbar-brand">‚ôªÔ∏è Ecoembes</a>
            <div class="d-flex align-items-center">
                <span class="text-white me-3" th:text="${email}"></span>
                <a href="/logout" class="btn btn-outline-light btn-sm">Cerrar Sesi√≥n</a>
            </div>
        </div>
    </nav>
    
    <div class="container mt-5">
        <!-- Header de √©xito -->
        <div class="text-center mb-4">
            <div class="success-icon">‚úÖ</div>
            <h1 class="text-success">¬°Asignaci√≥n Completada!</h1>
            <p class="lead text-muted">Los contenedores han sido asignados exitosamente a la planta de reciclaje.</p>
        </div>
        
        <!-- Alerta de saturaci√≥n si aplica -->
        <div th:if="${resumen.alertaSaturacion}" class="alert alert-warning alert-dismissible fade show" role="alert">
            <h4 class="alert-heading">‚ö†Ô∏è Alerta de Saturaci√≥n - <span th:text="${resumen.nivelAlerta}"></span></h4>
            <p>La planta <strong th:text="${resumen.planta.nombre}"></strong> est√° al 
               <strong th:text="${resumen.porcentajeOcupacionPlanta}"></strong>% de su capacidad.</p>
            <hr>
            <p class="mb-0">Se ha enviado una notificaci√≥n de alerta. Se recomienda tomar acciones preventivas.</p>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <!-- Resumen de la asignaci√≥n -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üìä Resumen de la Asignaci√≥n</h4>
            </div>
            <div class="card-body">
                <div class="row g-4">
                    <div class="col-md-3">
                        <div class="stat-box">
                            <div class="stat-number" th:text="${resumen.totalContenedores}">0</div>
                            <div class="text-muted">Contenedores</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box">
                            <div class="stat-number" th:text="${#numbers.formatDecimal(resumen.capacidadTotalAsignada, 1, 2)} + ' kg'">0 kg</div>
                            <div class="text-muted">Capacidad Asignada</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box" style="background: #e7f3ff;">
                            <div class="stat-number text-success" th:text="'~' + ${#numbers.formatInteger(resumen.envasesEstimados, 3, 'COMMA')}">0</div>
                            <div class="text-muted">üì¶ Envases Estimados</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box">
                            <div class="stat-number" th:text="${resumen.capacidadRestantePlanta} + ' kg'">0 kg</div>
                            <div class="text-muted">Capacidad Restante</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Informaci√≥n de la planta -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">üè≠ Planta de Destino</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Nombre:</strong> <span th:text="${resumen.planta.nombre}"></span></p>
                        <p><strong>ID:</strong> <span th:text="${resumen.planta.id}"></span></p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Capacidad Total:</strong> <span th:text="${resumen.planta.capacidad} + ' kg'"></span></p>
                        <p><strong>Ocupaci√≥n Actual:</strong> 
                            <span th:text="${resumen.porcentajeOcupacionPlanta} + '%'"></span>
                            <span th:if="${resumen.porcentajeOcupacionPlanta >= 90}" class="badge bg-danger">CR√çTICO</span>
                            <span th:if="${resumen.porcentajeOcupacionPlanta >= 75 and resumen.porcentajeOcupacionPlanta < 90}" class="badge bg-warning">ALTO</span>
                        </p>
                    </div>
                </div>
                <div class="progress" style="height: 30px;">
                    <div class="progress-bar" 
                         role="progressbar" 
                         th:style="'width: ' + ${resumen.porcentajeOcupacionPlanta} + '%'"
                         th:classappend="${resumen.porcentajeOcupacionPlanta >= 90 ? 'bg-danger' : (resumen.porcentajeOcupacionPlanta >= 75 ? 'bg-warning' : (resumen.porcentajeOcupacionPlanta >= 50 ? 'bg-info' : 'bg-success'))}"
                         th:text="${resumen.porcentajeOcupacionPlanta} + '% ocupado'">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Lista de contenedores asignados -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">üì¶ Contenedores Asignados</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>C√≥digo Postal</th>
                            <th>Capacidad</th>
                            <th>Nivel</th>
                            <th>Ocupaci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="contenedor : ${resumen.contenedoresAsignados}">
                            <td th:text="${contenedor.id}"></td>
                            <td th:text="${contenedor.codigoPostal}"></td>
                            <td th:text="${contenedor.capacidad} + ' kg'"></td>
                            <td>
                                <span class="badge" 
                                      th:classappend="${'badge-' + contenedor.nivelDeLlenado}"
                                      th:text="${contenedor.nivelDeLlenado}">
                                </span>
                            </td>
                            <td th:text="${#numbers.formatDecimal(contenedor.capacidadOcupada, 1, 2)} + ' kg'"></td>
                        </tr>
                    </tbody>
                    <tfoot class="table-light">
                        <tr>
                            <td colspan="4" class="text-end"><strong>Total:</strong></td>
                            <td><strong th:text="${#numbers.formatDecimal(resumen.capacidadTotalAsignada, 1, 2)} + ' kg'"></strong></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        
        <!-- Informaci√≥n de notificaci√≥n -->
        <div class="alert alert-info" role="alert">
            <h5 class="alert-heading">üìß Notificaci√≥n Enviada</h5>
            <p>Se ha enviado un correo electr√≥nico con el resumen de esta asignaci√≥n incluyendo:</p>
            <ul>
                <li>Total de contenedores: <strong th:text="${resumen.totalContenedores}"></strong></li>
                <li>Capacidad total asignada: <strong th:text="${#numbers.formatDecimal(resumen.capacidadTotalAsignada, 1, 2)} + ' kg'"></strong></li>
                <li>Envases estimados: <strong th:text="'~' + ${#numbers.formatInteger(resumen.envasesEstimados, 3, 'COMMA')}"></strong></li>
            </ul>
        </div>
        
        <!-- Botones de acci√≥n -->
        <div class="d-flex gap-3 justify-content-center mt-4 mb-5">
            <a href="/asignaciones" class="btn btn-primary btn-lg">
                ‚ûï Nueva Asignaci√≥n
            </a>
            <a href="/plantas" class="btn btn-outline-primary btn-lg">
                üè≠ Ver Plantas
            </a>
            <a href="/dashboard" class="btn btn-outline-secondary btn-lg">
                üè† Ir al Dashboard
            </a>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
